<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test For Scratchers</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f1f3f4;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 750px;
  margin: auto;
}

.card {
  background: white;
  padding: 25px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  margin-bottom: 20px;
}

h1 { text-align: center; }

h2 {
  border-bottom: 2px solid #1a73e8;
  padding-bottom: 5px;
}

/* ===== 説明文（会話文）のスタイル ===== */
.story {
  background: #f8f9fa;
  border-left: 4px solid #1a73e8;
  border-radius: 0 6px 6px 0;
  padding: 14px 18px;
  margin: 16px 0;
  color: #333;
  line-height: 1.8;
  font-size: 0.97em;
}

.story-label {
  font-size: 0.78em;
  font-weight: bold;
  color: #1a73e8;
  letter-spacing: 0.05em;
  margin-bottom: 6px;
}

/* ===== 問題のスタイル ===== */
.question {
  margin: 20px 0;
  background: #fff8e1;
  border: 1px solid #f9a825;
  border-top: 4px solid #f9a825;
  border-radius: 6px;
  padding: 14px 16px;
  position: relative;
}

.question > p:first-child {
  font-weight: bold;
  color: #555;
  margin-top: 0;
}

/* ===== 正誤バッジ ===== */
.question-result-badge {
  display: inline-block;
  font-size: 0.85em;
  font-weight: bold;
  padding: 2px 10px;
  border-radius: 10px;
  margin-left: 10px;
  vertical-align: middle;
}
.badge-correct {
  background: #e6f4ea;
  color: #188038;
  border: 1px solid #34a853;
}
.badge-incorrect {
  background: #fce8e6;
  color: #c5221f;
  border: 1px solid #ea4335;
}

/* 正解・不正解の問題枠色変化 */
.question.result-correct {
  border-top-color: #34a853;
  border-color: #34a853;
  background: #f0faf2;
}
.question.result-incorrect {
  border-top-color: #ea4335;
  border-color: #ea4335;
  background: #fff5f5;
}

/* 正解の選択肢ハイライト（提出後） */
.option-card.show-correct {
  border-color: #34a853 !important;
  border-width: 2px !important;
  background: #e6f4ea !important;
}
/* 不正解で選んだ選択肢ハイライト（提出後） */
.option-card.show-wrong-selected {
  border-color: #ea4335 !important;
  border-width: 2px !important;
  background: #fce8e6 !important;
}

/* 正解テキスト（数値入力用） */
.correct-answer-note {
  margin-top: 10px;
  padding: 6px 12px;
  background: #e6f4ea;
  border-radius: 4px;
  color: #188038;
  font-size: 0.88em;
  font-weight: bold;
}

button {
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  background: #1a73e8;
  color: white;
}
button:hover { background: #1558b0; }

.nav {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

.hidden { display: none; }

.progress {
  height: 6px;
  background: #ddd;
  border-radius: 3px;
  margin-bottom: 15px;
}
.progress-bar {
  height: 100%;
  background: #1a73e8;
  width: 0%;
  border-radius: 3px;
}

.options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-top: 10px;
}

.option-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  cursor: pointer;
  transition: border-color 0.2s, background 0.2s;
  text-align: center;
  background: white;
}
.option-card img {
  max-width: 100%;
  border-radius: 6px;
  margin-bottom: 8px;
}
.option-card input {
  display: none;
}
.option-card:hover {
  border-color: #1a73e8;
}

/* ===== 画像なし選択肢も青枠で囲む（修正） ===== */
.option-card:has(input:checked) {
  border-color: #1a73e8;
  border-width: 2px;
  background: #e8f0fe;
}
/* 画像あり選択肢は画像にアウトライン */
.option-card input:checked + img {
  outline: 3px solid #1a73e8;
  border-radius: 6px;
}

/* 提出後は操作不可 */
.submitted .option-card {
  cursor: default;
  pointer-events: none;
}
.submitted input[type="number"] {
  pointer-events: none;
  background: #f5f5f5;
}

/* カード直下・問題・説明内の説明用画像 */
.card > img,
.question > img,
.story img {
  max-width: 60%;
  display: block;
  margin: 8px auto;
}

/* 結果画面 */
.score-display {
  font-size: 2.5em;
  text-align: center;
  padding: 20px;
  color: #1a73e8;
  font-weight: bold;
}
.review-btn {
  display: block;
  margin: 10px auto 0;
  background: #34a853;
  font-size: 1em;
  padding: 10px 24px;
}
.review-btn:hover { background: #2d8f47 !important; }
</style>
</head>

<body>
<div class="container">
<h1>Test For Scratchers</h1>

<div class="progress">
  <div class="progress-bar" id="progressBar"></div>
</div>

<!-- セクション1: イントロ -->
<div class="card section" id="section1">
  <h2>このテストについて。</h2>
  <p>このテストは、scratcherによるscratcherのscratchのためのテストです。</p>
  <p>大問は1から4まであり、100点満点です。</p>
  <p>次へ ボタンをクリックすると、大問1に入ります。</p>
  <div class="nav">
    <div></div>
    <button onclick="nextSection(1)">次へ</button>
  </div>
</div>

<!-- セクション2: 大問1 -->
<div class="card section hidden" id="section2">
  <h2>大問1</h2>
  <h3>たけるくんと先生がコンピューター室で話しています。<br>問題を読み、答えなさい。</h3>

  <div class="story">
    <div class="story-label">場面</div>
    たけるくん)　僕、あるゲームを作ろうと思っているんです。<br>
    先生)　どういうゲームですか？<br>
    たけるくん)　合図が出たらクリックして、どれだけズレが少ないかを競うゲームです。<br>
    先生)　いいですね！そのような仕組みが簡単なゲームはscratchで作成するのがおすすめです。早速作ってみましょう。<br>
    たけるくん)　了解です。ええと...まずは旗が押されたとき...できました！<br>
    先生)　速いですね！では動かしてみましょう。...あれ、正しく動作しませんね。<br>
    「画面をクリック!」は表示されますが、画面をクリックしても結果が表示されません。スクリプトを見せてください。(あ)
  </div>

  <div class="question" id="q1_box">
    <p>(1) (あ)の時点でのスクリプトとしてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選べ。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q1" value="1"><img src="imgs/img1.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q1" value="2"><img src="imgs/img2.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q1" value="3"><img src="imgs/img3.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q1" value="4"><img src="imgs/img4.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q1" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="story">
    <div class="story-label">場面</div>
    先生)　このスクリプトでは正しく動作しませんね。先生が修正してあげましょう。<br>
    たけるくん)　ありがとうございます。ちゃんと動くようになりました。<br>
    先生)　ですがこれだと味気ないですね。更にいろんな機能を追加してみましょう。<br>
    たけるさんは、「クラウド変数」を知っていますか？<br>
    たけるくん)　はい。他のユーザーと値をやり取りできる変数のことですよね。<br>
    先生)　そのとおりです。そのクラウド変数を使って、このゲームをオンライン対戦ゲームにすれば面白いと思いませんか？<br>
    たけるくん)　すごくいいですね！やってみたいです！<br>
    先生)　それでは一緒に作ってみましょう。<br>
    ☁player1、☁player2、☁counterの3つのクラウド変数を作成しました。それぞれのクラウド変数の初期値は0です。プレイヤーが旗を押したとき、☁counterの値を1増やします。☁counterが2になったらゲームを開始します。<br>
    たけるくん)　なるほど。それで、☁player1、2はそれぞれのユーザーの結果の値にすればいいのですね。作ってみます...できました！<br>
    先生)　スクリプトを見せてください...これでも正しく動作しますが、タイマーの小数点をなくしてみましょう。タイマーの値は小数第2位までなので、このようにします。(い)
  </div>

  <div class="question" id="q2_box">
    <p>(2) このスクリプトは、(い)の時点でのスクリプトの一部である。これの下に続くスクリプトとしてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選べ。</p>
    <img src="imgs/img10.png" alt="">
    <div class="options">
      <label class="option-card"><input type="radio" name="q2" value="1"><img src="imgs/img6.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q2" value="2"><img src="imgs/img7.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q2" value="3"><img src="imgs/img8.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q2" value="4"><img src="imgs/img9.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q2" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="story">
    <div class="story-label">場面</div>
    先生)　このスクリプトの一番下に「☁counterを0にする」というブロックを追加しておいてください。これで正しく動作するはずです。<br>
    たけるくん)　やった！実際に遊んでみます。...あれ。<br>
    先生)　どうしましたか？<br>
    たけるくん)　友達とプレイしてみたのですが、僕の画面と友達の画面の動作のタイミングが少しズレています。<br>
    先生)　いいところに気づきましたね。クラウド変数は変更が反映されるまで時間がかかるのです。せっかくなので、そのタイムラグもなくしてみましょう。<br>
    たけるくん)　できるのですか？<br>
    先生)　できます。「2000年からの日数」を使用します。2000年からの日数の値は全てのユーザーで共通しています。この仕組みを使って作ってみましょう。まず、2000年からの日数の値を2000年からのティック数に変換します。ティックとは、ゲーム内の世界が更新される時間の最小単位のことで、scratchでは1秒は30ティックです。(3)<br>
    2000年からのティック数に変換する部分は定義ブロックで定義しましょう。<br>
    たけるくん)　うーんと、player1が2000年からのティック数をplayer2に送って、同時にスタートさせる仕組みにすればいい感じですね。<br>
    あと、タイマーの部分も2000年からのティック数に変えちゃいます。3人目のユーザーが来たとき用の処理も追加して...できました。<br>
    先生)　むだがなく完璧ですね。デバッグとして先生と遊んでみましょう。<br>
    たけるくん)　ちゃんと動作しますね。先生、協力してくれてありがとうございました！
  </div>

  <div class="question" id="q3_box">
    <p>(3) 2000年からの日数を2000年からのティック数に変換するにはどのように計算すればよいか。もっとも正しいものを1つ選べ。ただし、正しいものがない場合は「正しいものはない。」を選べ。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q3" value="1"><span>2000年からの日数 × 24(時間) × 60(分) × 60(秒) × 30</span></label>
      <label class="option-card"><input type="radio" name="q3" value="2"><span>2000年からの日数 × 24(時間) × 60(分) × 60(秒) × 60</span></label>
      <label class="option-card"><input type="radio" name="q3" value="3"><span>2000年からの日数 × 24(時間) × 60(分) × 60(秒) ÷ 30</span></label>
      <label class="option-card"><input type="radio" name="q3" value="4"><span>2000年からの日数 × 24(時間) × 60(分) × 60(秒) ÷ 60</span></label>
      <label class="option-card"><input type="radio" name="q3" value="5"><span>2000年からの日数 ÷ 24(時間) × 60(分) × 60(秒) × 30</span></label>
      <label class="option-card"><input type="radio" name="q3" value="6"><span>2000年からの日数 ÷ 24(時間) × 60(分) × 60(秒) × 60</span></label>
      <label class="option-card"><input type="radio" name="q3" value="7"><span>2000年からの日数 ÷ 24(時間) × 60(分) × 60(秒) ÷ 30</span></label>
      <label class="option-card"><input type="radio" name="q3" value="8"><span>2000年からの日数 ÷ 24(時間) × 60(分) × 60(秒) ÷ 60</span></label>
      <label class="option-card"><input type="radio" name="q3" value="9"><span>正しいものはない。</span></label>
    </div>
  </div>

  <div class="question" id="q4_box">
    <p>(4) 最終的なスクリプトとしてもっとも正しいものを1つ選びなさい。なお、スクリプトは一部...で省略している。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q4" value="1"><img src="imgs/img11.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q4" value="2"><img src="imgs/img12.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q4" value="3"><img src="imgs/img13.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q4" value="4"><img src="imgs/img14.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q4" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="question" id="q5_box">
    <p>(5) 勝ち負けの精度を更に良くするためにはどうすればよいか。最も正しいものを選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q5" value="1"><span>2000年からのティック数に100を足す</span></label>
      <label class="option-card"><input type="radio" name="q5" value="2"><span>2000年からのティック数を100で割る</span></label>
      <label class="option-card"><input type="radio" name="q5" value="3"><span>2000年からのティック数から100引く</span></label>
      <label class="option-card"><input type="radio" name="q5" value="4"><span>2000年からのティック数を100倍する</span></label>
      <label class="option-card"><input type="radio" name="q5" value="5"><span>何をしても変わらない。</span></label>
    </div>
  </div>

  <p>大問1は以上です。</p>
  <div class="nav">
    <button onclick="prevSection(2)">戻る</button>
    <button onclick="nextSection(2)">次へ</button>
  </div>
</div>

<!-- セクション3: 大問2 -->
<div class="card section hidden" id="section3">
  <h2>大問2</h2>
  <h3>問題を読み、答えなさい。</h3>

  <div class="story">
    <div class="story-label">説明</div>
    ゆめさんは、scratchで使用するオリジナルのデータ交換フォーマット、SSONを作っています。<br>
    次の画像は、そのSSONをデコードする関数です。<br>
    ①, ②を答えなさい。ただし、空白のものはnullと表す。
  </div>

  <img src="imgs/img15.png" alt="">

  <div class="question" id="q6_box">
    <p>① UN/player1/scene/home/ask/<br>
      このSSONテキストをデコードしたときのresultを1番から順に読んだときのものとしてもっとも正しいものを1つ選びなさい。<br>
      ただし、正しいものがない場合は、「正しいものはない。」を選択しなさい。
    </p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q6" value="1"><span>UN, player1, scene, home, ask</span></label>
      <label class="option-card"><input type="radio" name="q6" value="2"><span>UN, scene, ask, player1, home</span></label>
      <label class="option-card"><input type="radio" name="q6" value="3"><span>UN, player1, scene, home, ask, null</span></label>
      <label class="option-card"><input type="radio" name="q6" value="4"><span>UN, scene, ask, player1, home, null</span></label>
      <label class="option-card"><input type="radio" name="q6" value="5"><span>正しいものはない。</span></label>
    </div>
  </div>

  <div class="question" id="q7_box">
    <p>② エンコード関数としてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q7" value="1"><img src="imgs/img16.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q7" value="2"><img src="imgs/img17.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q7" value="3"><img src="imgs/img18.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q7" value="4"><img src="imgs/img19.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q7" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="question" id="q8_box">
    <p>(2) 旗を押したときのcounterの値を入力しなさい。</p>
    <img src="imgs/img20.png" alt="">
    <input type="number" name="q8" style="padding:6px; border:1px solid #ccc; border-radius:4px; width:120px;">
  </div>

  <div class="question" id="q9_box">
    <p>(3) 1+2+3+4+5+6+7+8+9+10を計算するものとしてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q9" value="1"><img src="imgs/img21.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q9" value="2"><img src="imgs/img22.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q9" value="3"><img src="imgs/img23.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q9" value="4"><img src="imgs/img24.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q9" value="5"><span>5</span></label>
    </div>
  </div>

  <p>大問2は以上です。</p>
  <div class="nav">
    <button onclick="prevSection(3)">戻る</button>
    <button onclick="nextSection(3)">次へ</button>
  </div>
</div>

<!-- セクション4: 大問3 -->
<div class="card section hidden" id="section4">
  <h2>大問3</h2>
  <h3>問題を読み、答えなさい。</h3>

  <div class="story">
    <div class="story-label">説明</div>
    まもるくんは256×256のRPGマップを、タイルマップ式で描画するプログラムを作ろうとしている。<br>
    タイルマップとは、小さな画像（タイル）をマス目状に並べて、1つの大きなマップを作る仕組みのことである。<br>
    まず、描画を簡単にするためにタイルの座標データをリストbx、byに生成するスクリプトを作った。
  </div>

  <img src="imgs/img25.png" alt="">

  <div class="story">
    <div class="story-label">説明</div>
    マップのデータは、<br>
    0→地面、1→壁としてデータ化してリストmap dataに保存されている。<br>
    まもるくんは次にマップデータのデコードして、タイルごとのデータをリストbcに格納する関数を作成した。
  </div>

  <img src="imgs/img26.png" alt="">

  <div class="question" id="q10_box">
    <p>(1) ある1つのタイルの属性を「地面(0)」から「壁(1)」に変更したい。しかし、配列全体を毎回作り直すと65536(256×256)回の処理が必要になってしまう。<br>
      そこで、あらかじめmapdataを幅wマスごとに分割（スライス）して保存しておくことにする。<br>
      タイルが変更されたときは：<br>
      1, そのタイルが含まれるスライスだけを書き換える<br>
      2, すべてのスライスを連結して1つの配列に戻す<br>
      とする。<br>
      スライス幅wは65536を割り切る整数とするとき、1回のタイル変更にかかる処理回数を最小にするためには、スライス幅wを何マスにすればよいか求めよ。
    </p>
    <input type="number" name="q10" style="padding:6px; border:1px solid #ccc; border-radius:4px; width:120px;">
  </div>

  <div class="question" id="q11_box">
    <p>(2) (1)の方法を用いることで、配列全体を作り直す方法の何倍高速化することができたか。</p>
    <input type="number" name="q11" style="padding:6px; border:1px solid #ccc; border-radius:4px; width:120px;">
  </div>

  <div class="question" id="q12_box">
    <p>(3) スライス機能を追加した関数「マップデータのデコード」としてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q12" value="1"><img src="imgs/img27.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q12" value="2"><img src="imgs/img28.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q12" value="3"><img src="imgs/img29.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q12" value="4"><img src="imgs/img30.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q12" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="story">
    <div class="story-label">説明</div>
    次に、まもるくんは画面を描画する関数を作成した。<br>
    関数画面描画は、毎フレーム実行する。<br>
    また、新しい変数camera_X, camera_Y, player_X, player_Yを作成した。<br>
    下の図は、関数画面描画のスクリプトである。
  </div>

  <img src="imgs/img31.png" alt="">

  <div class="question" id="q13_box">
    <p>(4) 関数スタート番号のスクリプトとしてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q13" value="1"><img src="imgs/img32.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q13" value="2"><img src="imgs/img33.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q13" value="3"><img src="imgs/img34.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q13" value="4"><img src="imgs/img35.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q13" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="story">
    <div class="story-label">説明</div>
    最後にまもるくんは関数プレイヤーの操作を作った。この関数は関数画面描画の前に実行し、毎フレーム実行する。<br>
    イベントright, down, left, upはプレイヤーを3ティックかけて1マス移動させるイベントであり、イベント終了後にmovingが0になる。
  </div>

  <img src="imgs/img36.png" alt="">

  <div class="question" id="q14_box">
    <p>(5) 関数当たり判定としてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q14" value="1"><img src="imgs/img37.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q14" value="2"><img src="imgs/img38.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q14" value="3"><img src="imgs/img39.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q14" value="4"><img src="imgs/img40.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q14" value="5"><span>5</span></label>
    </div>
  </div>

  <p>大問3は以上です。</p>
  <div class="nav">
    <button onclick="prevSection(4)">戻る</button>
    <button onclick="nextSection(4)">次へ</button>
  </div>
</div>

<!-- セクション5: 大問4 -->
<div class="card section hidden" id="section5">
  <h2>大問4</h2>
  <h3>
    花子さんが天井と糸で繋がれたボールの動きをシミュレーションする作品を作ろうとしている。<br>
    問題を読み、答えなさい。
  </h3>

  <div class="story">
    <div class="story-label">説明</div>
    花子さんは、天井と糸で繋がれたボールの動きをシミュレーションする作品を作ろうとしている。<br>
    ボールは重力の影響を受けて落下するが、糸が引っ張られると振り子運動に変わる。<br>
    花子さんはまず、画面を描画する関数を作成した。
  </div>

  <img src="imgs/img41.png" alt="">

  <div class="story">
    <div class="story-label">説明</div>
    次に、花子さんはボールの動きを計算する関数を作成した。<br>
    この関数は毎フレーム実行される。<br>
    緑の旗が押されたとき、それぞれの変数はこのように設定される。<br>
    x=150, y=50, vx=0, vy=0, g=-0.5, L=150, state=slack。<br>
    x, yはボールの座標、vx, vyはボールの速度、gは重力加速度、Lは糸の長さ、stateは糸の状態を表す変数で、slackのとき自由落下運動をし、tautのとき振り子運動をする。<br>
    また、振り子の支点は(0,130)に固定されている。
  </div>

  <div class="question" id="q15_box">
    <p>(1) stateがslackのときのボールの動きを計算するスクリプトの冒頭部分としてもっとも正しいものを1つ選びなさい。ここでは、ボールの座標を更新し、支点からボールまでの距離rを求める。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q15" value="1"><img src="imgs/img42.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q15" value="2"><img src="imgs/img43.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q15" value="3"><img src="imgs/img44.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q15" value="4"><img src="imgs/img45.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q15" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="story">
    <div class="story-label">説明</div>
    (1) のスクリプトの後に、rがL以上ときの動作を追加する。<br>
    まず、支点からボールへ向かう方向を表す単位ベクトルのx,y成分を求める。これで (nx, ny) は長さ1の方向ベクトルになる。<br>
    次に、ボールの位置を円周上に戻す。支点から同じ方向に、ちょうど糸の長さLだけ進んだ位置にボールを強制的に移動させる。<br>
    そして、現在の速度が半径方向にどれだけ向いているかを調べる。<br>
    続いて、速度のうち半径方向の成分をx,y成分から引く。つまり、半径方向に動こうとしている部分を取り除いている。<br>
    最後に、stateをtautに変更する。<br>
    これで、stateがslackのときのボールの挙動の計算ができる。
  </div>

  <div class="question" id="q16_box">
    <p>(2) (1)のスクリプトの後に追加するスクリプトとしてもっとも正しいものを1つ選びなさい。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q16" value="1"><img src="imgs/img46.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q16" value="2"><img src="imgs/img47.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q16" value="3"><img src="imgs/img48.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q16" value="4"><img src="imgs/img49.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q16" value="5"><span>5</span></label>
    </div>
  </div>

  <div class="story">
    <div class="story-label">説明</div>
    次に、stateがtautのときのボールの動きを計算するスクリプトを作成する。<br>
    まず、重力による加速度を速度に加える。<br>
    次に、支点からボールまでの距離を求める。<br>
    そして、支点からボールへ向かう方向の単位ベクトルのx,y成分を求め、これを(nx, ny)とする。<br>
    ここから、現在の速度のうち、半径方向にどれだけ向いているかを計算する。そして、速度から半径方向成分を引く。<br>
    その後、新しい速度を用いてボールの位置を更新する。<br>
    続いて、糸の張力の計算をし、もし張力が0より小さいならstateをslackにする。<br>
    速度の大きさの2乗を計算し、それをLで割ることで円運動に必要な向心加速度 v²/Lを求める。<br>
    これから、糸が支えなければならない力を求め、最終的なスクリプトはこうなる。<br>
    実際に緑の旗を押してみると正しく動作する事がわかる。
  </div>

  <div class="question" id="q17_box">
    <p>(3) stateがtautのときのスクリプトとしてもっとも正しいものを1つ選びなさい。stateがslackのときに使用したブロックが使われている部分は省略されている。ただし、正しいものがない場合は5を選びなさい。</p>
    <div class="options">
      <label class="option-card"><input type="radio" name="q17" value="1"><img src="imgs/img50.png" alt=""><span>1</span></label>
      <label class="option-card"><input type="radio" name="q17" value="2"><img src="imgs/img51.png" alt=""><span>2</span></label>
      <label class="option-card"><input type="radio" name="q17" value="3"><img src="imgs/img52.png" alt=""><span>3</span></label>
      <label class="option-card"><input type="radio" name="q17" value="4"><img src="imgs/img53.png" alt=""><span>4</span></label>
      <label class="option-card"><input type="radio" name="q17" value="5"><span>5</span></label>
    </div>
  </div>

  <p>大問4は以上です。</p>
  <div class="nav">
    <button onclick="prevSection(5)">戻る</button>
    <button onclick="showResult()">提出</button>
  </div>
</div>

<!-- 結果 -->
<div class="card hidden" id="resultSection">
  <h2>結果</h2>
  <div class="score-display" id="scoreDisplay"></div>
  <button class="review-btn" onclick="reviewAnswers()">回答を確認する</button>
</div>

</div>

<script>
const totalSections = 5;

// ===== 正解データ =====
const correctAnswers = {
  q1:  { type: 'radio',  value: '4'   },
  q2:  { type: 'radio',  value: '3'   },
  q3:  { type: 'radio',  value: '1'   },
  q4:  { type: 'radio',  value: '1'   },
  q5:  { type: 'radio',  value: '4'   },
  q6:  { type: 'radio',  value: '3'   },
  q7:  { type: 'radio',  value: '4'   },
  q8:  { type: 'number', value: '16'  },
  q9:  { type: 'radio',  value: '1'   },
  q10: { type: 'number', value: '256' },
  q11: { type: 'number', value: '128' },
  q12: { type: 'radio',  value: '3'   },
  q13: { type: 'radio',  value: '1'   },
  q14: { type: 'radio',  value: '2'   },
  q15: { type: 'radio',  value: '5'   },
  q16: { type: 'radio',  value: '3'   },
  q17: { type: 'radio',  value: '1'   },
};

// ===== 配点データ =====
const points = {
  q1: 5, q2: 5, q3: 5, q4: 5, q5: 5,
  q6: 5, q7: 5, q8: 5, q9: 5,
  q10: 6, q11: 5, q12: 6, q13: 6, q14: 6,
  q15: 8, q16: 9, q17: 9,
};

function updateProgress(section) {
  const percent = (section - 1) / (totalSections - 1) * 100;
  document.getElementById("progressBar").style.width = percent + "%";
}

function nextSection(current) {
  document.getElementById("section" + current).classList.add("hidden");
  document.getElementById("section" + (current + 1)).classList.remove("hidden");
  updateProgress(current + 1);
  window.scrollTo(0, 0);
}

function prevSection(current) {
  document.getElementById("section" + current).classList.add("hidden");
  document.getElementById("section" + (current - 1)).classList.remove("hidden");
  updateProgress(current - 1);
  window.scrollTo(0, 0);
}

function getUserAnswer(name, type) {
  if (type === 'radio') {
    return document.querySelector(`[name="${name}"]:checked`)?.value ?? null;
  } else {
    return document.querySelector(`[name="${name}"]`)?.value || null;
  }
}

function showResult() {
  const confirmed = confirm("提出しますか？\n提出後は回答を変更できません。");
  if (!confirmed) return;

  let score = 0;

  // --- 採点 ---
  for (const [name, info] of Object.entries(correctAnswers)) {
    const userVal = getUserAnswer(name, info.type);
    if (userVal == info.value) {
      score += points[name];
    }
  }

  // --- 全inputを無効化・操作不可に ---
  document.querySelectorAll('.section input').forEach(el => el.disabled = true);
  document.querySelectorAll('.section').forEach(el => el.classList.add('submitted'));

  // --- 各問題に正誤バッジ＆ハイライトを付ける ---
  for (const [name, info] of Object.entries(correctAnswers)) {
    const box = document.getElementById(name + '_box');
    if (!box) continue;

    const userVal = getUserAnswer(name, info.type);
    const isCorrect = (userVal == info.value);

    // 問題枠の色を変える
    box.classList.add(isCorrect ? 'result-correct' : 'result-incorrect');

    // 問題文にバッジを追加
    const firstP = box.querySelector('p');
    if (firstP) {
      const badge = document.createElement('span');
      badge.classList.add('question-result-badge', isCorrect ? 'badge-correct' : 'badge-incorrect');
      badge.textContent = isCorrect ? '正解' : '不正解';
      firstP.appendChild(badge);
    }

    if (!isCorrect) {
      if (info.type === 'radio') {
        // 正解の選択肢を緑でハイライト
        const correctLabel = box.querySelector(`input[value="${info.value}"]`)?.closest('.option-card');
        if (correctLabel) correctLabel.classList.add('show-correct');
        // 自分が選んだ選択肢を赤でハイライト
        if (userVal) {
          const wrongLabel = box.querySelector(`input[value="${userVal}"]`)?.closest('.option-card');
          if (wrongLabel) wrongLabel.classList.add('show-wrong-selected');
        }
      } else {
        // 数値入力の場合は正解を文字で表示
        const note = document.createElement('div');
        note.classList.add('correct-answer-note');
        note.textContent = `正解: ${info.value}`;
        box.appendChild(note);
      }
    }
  }

  // --- 結果画面へ ---
  document.getElementById("section5").classList.add("hidden");
  document.getElementById("resultSection").classList.remove("hidden");
  document.getElementById("scoreDisplay").textContent = score + " / 100 点";
  window.scrollTo(0, 0);
}

// 結果画面から大問1へ戻って確認
function reviewAnswers() {
  document.getElementById("resultSection").classList.add("hidden");
  document.getElementById("section2").classList.remove("hidden");
  updateProgress(2);
  window.scrollTo(0, 0);
}
</script>

</body>
</html>
